<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# opentelemetry

```go
import "github.com/blueprint-uservices/blueprint/plugins/opentelemetry"
```

Package OpenTelemetry provides a Blueprint plugin for instrumenting services and collecting OpenTelemetry traces. The plugin provides APIs to be used in the wiring specification for the following:

1. to wrap the service with an OpenTelemetry wrapper to generate OT compatible traces by starting and stopping client spans for remote calls between services and correctly propagating context between services. The traces are then exported to a collector client such as [jaeger](<https://github.com/Blueprint-uServices/blueprint/tree/main/plugins/jaeger>) or [zipkin](<https://github.com/Blueprint-uServices/blueprint/tree/main/plugins/zipkin>).
2. to install an opentelemetry trace\-based event logger for a go process. The logger adds all the logs as events to the current active span. If no active span exists, then no events are logged.

Once the application is instrumented with these plugins, traces will be generated by the instrumented services, and collected centrally at the trace collector.

### Wiring Usage

To instrument services with opentelemetry instrumentation:

```
opentelemetry.Instrument(spec, "my_service", "collector_name")
```

Calling [Instrument](<#Instrument>) will generate client and server side wrappers responsible for starting and stopping spans as well as correctly propagating the context across service boundaries.

To redirect a process's logging statements to opentelemetry generated spans:

```
opentelemetry.Logger(spec, "my_process")
```

Calling [Logger](<#Logger>) will redirect all logging statements generated by the process to opentelemetry where the log statements will be converted into opentelemetry Events and added to the list of events for the current active span.

In order to generate complete end\-to\-end traces of the application, all services of the application need to be instrumented with OpenTelemetry. If the plugin is only applied to a subset of services, the application will run, but the traces produced won't be end\-to\-end and won't be useful. The plugin does not support instrumenting clients for backends such as databases, caches, queues, etc. If needed, please consider submitting a PR or contacting the maintainers via google groups or on slack.

### Artifacts Generated

1. The package generates client and server side wrappers for instrumented services that contain opentelemetry instrumentation \(context propagation, creation of spans\). The generated clients handle context propagation correctly on both the server and client sides. The implementation of the logger is located at [runtime/plugins/opentelemetry](<https://pkg.go.dev/runtime/plugins/opentelemetry/>) and if the opentelemetry logger is installed for a process then this logger is used.

Example usage \(for complete instrumentation\):

### Wiring Example

```
func applyOTelOptions() {
	jaeger.Container(spec, "jaeger")
	for _, service := range serviceNames {
		opentelemetry.Instrument(spec, service)
	}
	for _, proc := range processNames {
		opentelemetry.Logger(spec, proc)
	}
}
```

See the [ot\\\_logger](<https://github.com/Blueprint-uServices/blueprint/tree/main/examples/leaf/wiring/specs/custom_logger.go>) wiring spec for the Leaf application for a complete example

### Accessing Traces

The traces are generated and sent to the configured \([zipkin](<https://github.com/Blueprint-uServices/blueprint/tree/main/plugins/zipkin>) or [jaeger](<https://github.com/Blueprint-uServices/blueprint/tree/main/plugins/jaeger>)\) collector. Each collector exposes a web UI which can be used to access end\-to\-end traces. For Zipkin, the UI is hosted at port 9411 by default and for Jaeger, the UI is hosted at port 16686 by default.

## Index

- [func Instrument\(spec wiring.WiringSpec, serviceName string, collectorName string\)](<#Instrument>)
- [func Logger\(spec wiring.WiringSpec, processName string\) string](<#Logger>)
- [type OTTraceLogger](<#OTTraceLogger>)
  - [func \(node \*OTTraceLogger\) AddInstantiation\(builder golang.NamespaceBuilder\) error](<#OTTraceLogger.AddInstantiation>)
  - [func \(node \*OTTraceLogger\) AddInterfaces\(builder golang.ModuleBuilder\) error](<#OTTraceLogger.AddInterfaces>)
  - [func \(node \*OTTraceLogger\) AddToWorkspace\(builder golang.WorkspaceBuilder\) error](<#OTTraceLogger.AddToWorkspace>)
  - [func \(node \*OTTraceLogger\) GetInterface\(ctx ir.BuildContext\) \(service.ServiceInterface, error\)](<#OTTraceLogger.GetInterface>)
  - [func \(node \*OTTraceLogger\) ImplementsGolangNode\(\)](<#OTTraceLogger.ImplementsGolangNode>)
  - [func \(node \*OTTraceLogger\) Name\(\) string](<#OTTraceLogger.Name>)
  - [func \(node \*OTTraceLogger\) String\(\) string](<#OTTraceLogger.String>)
- [type OpenTelemetryClientWrapper](<#OpenTelemetryClientWrapper>)
  - [func \(node \*OpenTelemetryClientWrapper\) AddInstantiation\(builder golang.NamespaceBuilder\) error](<#OpenTelemetryClientWrapper.AddInstantiation>)
  - [func \(node \*OpenTelemetryClientWrapper\) AddInterfaces\(builder golang.ModuleBuilder\) error](<#OpenTelemetryClientWrapper.AddInterfaces>)
  - [func \(node \*OpenTelemetryClientWrapper\) GenerateFuncs\(builder golang.ModuleBuilder\) error](<#OpenTelemetryClientWrapper.GenerateFuncs>)
  - [func \(node \*OpenTelemetryClientWrapper\) GetInterface\(ctx ir.BuildContext\) \(service.ServiceInterface, error\)](<#OpenTelemetryClientWrapper.GetInterface>)
  - [func \(node \*OpenTelemetryClientWrapper\) ImplementsGolangNode\(\)](<#OpenTelemetryClientWrapper.ImplementsGolangNode>)
  - [func \(node \*OpenTelemetryClientWrapper\) ImplementsGolangService\(\)](<#OpenTelemetryClientWrapper.ImplementsGolangService>)
  - [func \(node \*OpenTelemetryClientWrapper\) Name\(\) string](<#OpenTelemetryClientWrapper.Name>)
  - [func \(node \*OpenTelemetryClientWrapper\) String\(\) string](<#OpenTelemetryClientWrapper.String>)
- [type OpenTelemetryCollectorInterface](<#OpenTelemetryCollectorInterface>)
- [type OpenTelemetryServerWrapper](<#OpenTelemetryServerWrapper>)
  - [func \(node \*OpenTelemetryServerWrapper\) AddInstantiation\(builder golang.NamespaceBuilder\) error](<#OpenTelemetryServerWrapper.AddInstantiation>)
  - [func \(node \*OpenTelemetryServerWrapper\) AddInterfaces\(builder golang.ModuleBuilder\) error](<#OpenTelemetryServerWrapper.AddInterfaces>)
  - [func \(node \*OpenTelemetryServerWrapper\) GenerateFuncs\(builder golang.ModuleBuilder\) error](<#OpenTelemetryServerWrapper.GenerateFuncs>)
  - [func \(node \*OpenTelemetryServerWrapper\) GetInterface\(ctx ir.BuildContext\) \(service.ServiceInterface, error\)](<#OpenTelemetryServerWrapper.GetInterface>)
  - [func \(node \*OpenTelemetryServerWrapper\) ImplementsGolangNode\(\)](<#OpenTelemetryServerWrapper.ImplementsGolangNode>)
  - [func \(node \*OpenTelemetryServerWrapper\) ImplementsGolangService\(\)](<#OpenTelemetryServerWrapper.ImplementsGolangService>)
  - [func \(node \*OpenTelemetryServerWrapper\) Name\(\) string](<#OpenTelemetryServerWrapper.Name>)
  - [func \(node \*OpenTelemetryServerWrapper\) String\(\) string](<#OpenTelemetryServerWrapper.String>)


<a name="Instrument"></a>
## func [Instrument](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/wiring.go#L68>)

```go
func Instrument(spec wiring.WiringSpec, serviceName string, collectorName string)
```

[Instrument](<#Instrument>) can be used by wiring specs to instrument \`serviceName\` with OpenTelemetry. This can only be done if \`serviceName\` is a service declared in the wiring spec using \[workflow.Define\] and has not yet been deployed over the network using grpc, thrift, or http.

This call will configure the generated clients on server and client side to use the exporter provided by the custom collector indicated by the \`collectorName\`. The \`collectorName\` must already be declared in the wiring spec.

<a name="Logger"></a>
## func [Logger](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/wiring.go#L131>)

```go
func Logger(spec wiring.WiringSpec, processName string) string
```

[Logger](<#Logger>) can be used by wiring specs to install a process\-level ot logger for process \`processName\` to be used in tandem with an OT Tracer. Replaces the existing logger installed for the process.

Logs are added as \`ot.Events\` to the current span and will be added as events to the current span and won't appear in stdout.

If no current span is being recorded, then no events will be generated. Use \`Instrument\` to ensure that all services in a process are instrumented with OpenTelemetry and are creating active spans.

### Wiring Spec Usage:

```
opentelemetry.Logger(spec, "my_process")
```

<a name="OTTraceLogger"></a>
## type [OTTraceLogger](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_logger.go#L16-L23>)

Blueprint IR Node that represents a process\-level OT trace logger

```go
type OTTraceLogger struct {
    golang.Node
    golang.Instantiable

    LoggerName  string
    Iface       *goparser.ParsedInterface
    Constructor *gocode.Constructor
}
```

<a name="OTTraceLogger.AddInstantiation"></a>
### func \(\*OTTraceLogger\) [AddInstantiation](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_logger.go#L78>)

```go
func (node *OTTraceLogger) AddInstantiation(builder golang.NamespaceBuilder) error
```

Implements golang.Instantiable

<a name="OTTraceLogger.AddInterfaces"></a>
### func \(\*OTTraceLogger\) [AddInterfaces](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_logger.go#L68>)

```go
func (node *OTTraceLogger) AddInterfaces(builder golang.ModuleBuilder) error
```

Implements golang.ProvidesInterface

<a name="OTTraceLogger.AddToWorkspace"></a>
### func \(\*OTTraceLogger\) [AddToWorkspace](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_logger.go#L63>)

```go
func (node *OTTraceLogger) AddToWorkspace(builder golang.WorkspaceBuilder) error
```

Implements golang.ProvidesModule

<a name="OTTraceLogger.GetInterface"></a>
### func \(\*OTTraceLogger\) [GetInterface](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_logger.go#L73>)

```go
func (node *OTTraceLogger) GetInterface(ctx ir.BuildContext) (service.ServiceInterface, error)
```

Implements golang.ProvidesInterface

<a name="OTTraceLogger.ImplementsGolangNode"></a>
### func \(\*OTTraceLogger\) [ImplementsGolangNode](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_logger.go#L89>)

```go
func (node *OTTraceLogger) ImplementsGolangNode()
```

Implements ir.IRNode

<a name="OTTraceLogger.Name"></a>
### func \(\*OTTraceLogger\) [Name](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_logger.go#L53>)

```go
func (node *OTTraceLogger) Name() string
```

Implements ir.IRNode

<a name="OTTraceLogger.String"></a>
### func \(\*OTTraceLogger\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_logger.go#L58>)

```go
func (node *OTTraceLogger) String() string
```

Implements ir.IRNode

<a name="OpenTelemetryClientWrapper"></a>
## type [OpenTelemetryClientWrapper](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_client.go#L17-L25>)

Blueprint IR Node that wraps the client\-side of a service to generate ot compatible logs

```go
type OpenTelemetryClientWrapper struct {
    golang.Service
    golang.GeneratesFuncs

    WrapperName string

    Wrapped   golang.Service
    Collector OpenTelemetryCollectorInterface
    // contains filtered or unexported fields
}
```

<a name="OpenTelemetryClientWrapper.AddInstantiation"></a>
### func \(\*OpenTelemetryClientWrapper\) [AddInstantiation](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_client.go#L97>)

```go
func (node *OpenTelemetryClientWrapper) AddInstantiation(builder golang.NamespaceBuilder) error
```

Part of code generation compilation pass; provides instantiation snippet

<a name="OpenTelemetryClientWrapper.AddInterfaces"></a>
### func \(\*OpenTelemetryClientWrapper\) [AddInterfaces](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_client.go#L67>)

```go
func (node *OpenTelemetryClientWrapper) AddInterfaces(builder golang.ModuleBuilder) error
```

Part of code generation compilation pass; creates the interface definition code for the wrapper, and any new generated structs that are exposed and can be used by other IRNodes

<a name="OpenTelemetryClientWrapper.GenerateFuncs"></a>
### func \(\*OpenTelemetryClientWrapper\) [GenerateFuncs](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_client.go#L72>)

```go
func (node *OpenTelemetryClientWrapper) GenerateFuncs(builder golang.ModuleBuilder) error
```

Part of code generation compilation pass; provides implementation of interfaces from GenerateInterfaces

<a name="OpenTelemetryClientWrapper.GetInterface"></a>
### func \(\*OpenTelemetryClientWrapper\) [GetInterface](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_client.go#L61>)

```go
func (node *OpenTelemetryClientWrapper) GetInterface(ctx ir.BuildContext) (service.ServiceInterface, error)
```



<a name="OpenTelemetryClientWrapper.ImplementsGolangNode"></a>
### func \(\*OpenTelemetryClientWrapper\) [ImplementsGolangNode](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_client.go#L128>)

```go
func (node *OpenTelemetryClientWrapper) ImplementsGolangNode()
```



<a name="OpenTelemetryClientWrapper.ImplementsGolangService"></a>
### func \(\*OpenTelemetryClientWrapper\) [ImplementsGolangService](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_client.go#L129>)

```go
func (node *OpenTelemetryClientWrapper) ImplementsGolangService()
```



<a name="OpenTelemetryClientWrapper.Name"></a>
### func \(\*OpenTelemetryClientWrapper\) [Name](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_client.go#L36>)

```go
func (node *OpenTelemetryClientWrapper) Name() string
```



<a name="OpenTelemetryClientWrapper.String"></a>
### func \(\*OpenTelemetryClientWrapper\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_client.go#L40>)

```go
func (node *OpenTelemetryClientWrapper) String() string
```



<a name="OpenTelemetryCollectorInterface"></a>
## type [OpenTelemetryCollectorInterface](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_collector_client.go#L9-L13>)

Interface that indicates if an IRNode implements the OTCollector interface All custom collector clients \*\*must\*\* implement this interface

```go
type OpenTelemetryCollectorInterface interface {
    golang.Node
    golang.Instantiable
    ImplementsOTCollectorClient()
}
```

<a name="OpenTelemetryServerWrapper"></a>
## type [OpenTelemetryServerWrapper](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_server.go#L18-L27>)

Blueprint IR Node that wraps the server\-side of a service to generate ot compatible logs

```go
type OpenTelemetryServerWrapper struct {
    golang.Service
    golang.Instantiable
    golang.GeneratesFuncs

    WrapperName string

    Wrapped   golang.Service
    Collector OpenTelemetryCollectorInterface
    // contains filtered or unexported fields
}
```

<a name="OpenTelemetryServerWrapper.AddInstantiation"></a>
### func \(\*OpenTelemetryServerWrapper\) [AddInstantiation](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_server.go#L127>)

```go
func (node *OpenTelemetryServerWrapper) AddInstantiation(builder golang.NamespaceBuilder) error
```

Part of code generation compilation pass; provides instantiation snippet

<a name="OpenTelemetryServerWrapper.AddInterfaces"></a>
### func \(\*OpenTelemetryServerWrapper\) [AddInterfaces](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_server.go#L82>)

```go
func (node *OpenTelemetryServerWrapper) AddInterfaces(builder golang.ModuleBuilder) error
```

Part of code generation compilation pass; creates the interface definition code for the wrapper, and any new generated structs that are exposed and can be used by other IRNodes

<a name="OpenTelemetryServerWrapper.GenerateFuncs"></a>
### func \(\*OpenTelemetryServerWrapper\) [GenerateFuncs](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_server.go#L102>)

```go
func (node *OpenTelemetryServerWrapper) GenerateFuncs(builder golang.ModuleBuilder) error
```

Part of code generation compilation pass; provides implementation of interfaces from GenerateInterfaces

<a name="OpenTelemetryServerWrapper.GetInterface"></a>
### func \(\*OpenTelemetryServerWrapper\) [GetInterface](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_server.go#L73>)

```go
func (node *OpenTelemetryServerWrapper) GetInterface(ctx ir.BuildContext) (service.ServiceInterface, error)
```



<a name="OpenTelemetryServerWrapper.ImplementsGolangNode"></a>
### func \(\*OpenTelemetryServerWrapper\) [ImplementsGolangNode](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_server.go#L77>)

```go
func (node *OpenTelemetryServerWrapper) ImplementsGolangNode()
```



<a name="OpenTelemetryServerWrapper.ImplementsGolangService"></a>
### func \(\*OpenTelemetryServerWrapper\) [ImplementsGolangService](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_server.go#L78>)

```go
func (node *OpenTelemetryServerWrapper) ImplementsGolangService()
```



<a name="OpenTelemetryServerWrapper.Name"></a>
### func \(\*OpenTelemetryServerWrapper\) [Name](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_server.go#L48>)

```go
func (node *OpenTelemetryServerWrapper) Name() string
```



<a name="OpenTelemetryServerWrapper.String"></a>
### func \(\*OpenTelemetryServerWrapper\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/opentelemetry/ir_ot_server.go#L52>)

```go
func (node *OpenTelemetryServerWrapper) String() string
```



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
