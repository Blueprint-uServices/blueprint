<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# goparser

```go
import "github.com/blueprint-uservices/blueprint/plugins/golang/goparser"
```

Package goparser parses go modules and extracts module, package, struct, and interface information.

It is used by Blueprint to parse workflow specs.

## Index

- [func ExprStr\(e ast.Expr\) string](<#ExprStr>)
- [type ModuleInfo](<#ModuleInfo>)
  - [func FindModule\[T any\]\(\) \(\*ModuleInfo, \*gocode.UserType, error\)](<#FindModule>)
  - [func FindPackageModule\(pkgName string\) \(\*ModuleInfo, error\)](<#FindPackageModule>)
  - [func GetModuleInfo\(moduleName string\) \(\*ModuleInfo, error\)](<#GetModuleInfo>)
  - [func \(m \*ModuleInfo\) String\(\) string](<#ModuleInfo.String>)
- [type ParsedField](<#ParsedField>)
  - [func \(f \*ParsedField\) Parse\(\) error](<#ParsedField.Parse>)
  - [func \(f \*ParsedField\) String\(\) string](<#ParsedField.String>)
- [type ParsedFile](<#ParsedFile>)
  - [func \(f \*ParsedFile\) LoadFuncs\(\) error](<#ParsedFile.LoadFuncs>)
  - [func \(f \*ParsedFile\) LoadImports\(\) error](<#ParsedFile.LoadImports>)
  - [func \(f \*ParsedFile\) LoadStructsAndInterfaces\(\) error](<#ParsedFile.LoadStructsAndInterfaces>)
  - [func \(f \*ParsedFile\) LoadVars\(\) error](<#ParsedFile.LoadVars>)
  - [func \(f \*ParsedFile\) ResolveIdent\(name string, typeParams ...string\) gocode.TypeName](<#ParsedFile.ResolveIdent>)
  - [func \(f \*ParsedFile\) ResolveSelector\(packageShortName string, name string\) gocode.TypeName](<#ParsedFile.ResolveSelector>)
  - [func \(f \*ParsedFile\) ResolveType\(expr ast.Expr, typeParams ...string\) gocode.TypeName](<#ParsedFile.ResolveType>)
  - [func \(f \*ParsedFile\) String\(\) string](<#ParsedFile.String>)
- [type ParsedFunc](<#ParsedFunc>)
  - [func \(f \*ParsedFunc\) AsConstructor\(\) \*gocode.Constructor](<#ParsedFunc.AsConstructor>)
  - [func \(f \*ParsedFunc\) Parse\(\) error](<#ParsedFunc.Parse>)
  - [func \(f \*ParsedFunc\) String\(\) string](<#ParsedFunc.String>)
- [type ParsedImport](<#ParsedImport>)
- [type ParsedInterface](<#ParsedInterface>)
  - [func \(iface \*ParsedInterface\) ServiceInterface\(ctx ir.BuildContext\) \*gocode.ServiceInterface](<#ParsedInterface.ServiceInterface>)
  - [func \(i \*ParsedInterface\) String\(\) string](<#ParsedInterface.String>)
  - [func \(iface \*ParsedInterface\) Type\(\) \*gocode.UserType](<#ParsedInterface.Type>)
- [type ParsedModule](<#ParsedModule>)
  - [func \(mod \*ParsedModule\) Load\(\) error](<#ParsedModule.Load>)
  - [func \(mod \*ParsedModule\) String\(\) string](<#ParsedModule.String>)
- [type ParsedModuleSet](<#ParsedModuleSet>)
  - [func New\(parent \*ParsedModuleSet\) \*ParsedModuleSet](<#New>)
  - [func \(set \*ParsedModuleSet\) Add\(info \*ModuleInfo\) \(\*ParsedModule, error\)](<#ParsedModuleSet.Add>)
  - [func \(set \*ParsedModuleSet\) AddModule\(srcDir string\) \(\*ParsedModule, error\)](<#ParsedModuleSet.AddModule>)
  - [func \(set \*ParsedModuleSet\) AddModules\(srcDirs ...string\) error](<#ParsedModuleSet.AddModules>)
  - [func \(set \*ParsedModuleSet\) AddWorkspace\(workspaceDir string\) error](<#ParsedModuleSet.AddWorkspace>)
  - [func \(set \*ParsedModuleSet\) FindInterface\(pkgName string, name string\) \(\*ParsedInterface, error\)](<#ParsedModuleSet.FindInterface>)
  - [func \(set \*ParsedModuleSet\) FindStruct\(pkgName string, name string\) \(\*ParsedStruct, error\)](<#ParsedModuleSet.FindStruct>)
  - [func \(set \*ParsedModuleSet\) GetPackage\(name string\) \(\*ParsedPackage, error\)](<#ParsedModuleSet.GetPackage>)
  - [func \(set \*ParsedModuleSet\) String\(\) string](<#ParsedModuleSet.String>)
- [type ParsedPackage](<#ParsedPackage>)
  - [func \(pkg \*ParsedPackage\) Load\(\) error](<#ParsedPackage.Load>)
  - [func \(pkg \*ParsedPackage\) Parse\(\) error](<#ParsedPackage.Parse>)
  - [func \(pkg \*ParsedPackage\) String\(\) string](<#ParsedPackage.String>)
- [type ParsedStruct](<#ParsedStruct>)
  - [func \(f \*ParsedStruct\) String\(\) string](<#ParsedStruct.String>)
  - [func \(struc \*ParsedStruct\) Type\(\) \*gocode.UserType](<#ParsedStruct.Type>)
- [type ParsedVar](<#ParsedVar>)


<a name="ExprStr"></a>
## func [ExprStr](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/astutil.go#L13>)

```go
func ExprStr(e ast.Expr) string
```

Returns a string representation of an expr and its internals Useful for debugging golang code parsers.

<a name="ModuleInfo"></a>
## type [ModuleInfo](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/module.go#L14-L21>)

Metadata about a module, such as its version and location on the local file system.

```go
type ModuleInfo struct {
    ShortName string           // The last part of the module path
    Path      string           // Fully qualified name of the module
    Version   string           // Version of the module
    Dir       string           // Directory containing the module source
    IsLocal   bool             // True if the module is local (ie with a replace directive), false if it's from gocache
    GoModule  *packages.Module // The underlying golang module from [golang.org/x/tools/go/packages]
}
```

<a name="FindModule"></a>
### func [FindModule](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/module.go#L107>)

```go
func FindModule[T any]() (*ModuleInfo, *gocode.UserType, error)
```

Finds and returns the module info for a type.

<a name="FindPackageModule"></a>
### func [FindPackageModule](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/module.go#L65>)

```go
func FindPackageModule(pkgName string) (*ModuleInfo, error)
```

Get the module info for a package.

<a name="GetModuleInfo"></a>
### func [GetModuleInfo](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/module.go#L32>)

```go
func GetModuleInfo(moduleName string) (*ModuleInfo, error)
```

Get the info for a module. Better than reading the go.mod. Better than calling FindPackageModule because the root of the module doesn't need to be a golang package.

<a name="ModuleInfo.String"></a>
### func \(\*ModuleInfo\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/module.go#L23>)

```go
func (m *ModuleInfo) String() string
```



<a name="ParsedField"></a>
## type [ParsedField](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L110-L115>)



```go
type ParsedField struct {
    gocode.Variable
    Struct   *ParsedStruct
    Position int
    Ast      *ast.Field
}
```

<a name="ParsedField.Parse"></a>
### func \(\*ParsedField\) [Parse](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L314>)

```go
func (f *ParsedField) Parse() error
```



<a name="ParsedField.String"></a>
### func \(\*ParsedField\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L826>)

```go
func (f *ParsedField) String() string
```



<a name="ParsedFile"></a>
## type [ParsedFile](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L63-L71>)



```go
type ParsedFile struct {
    Package          *ParsedPackage
    Name             string                   // Filename
    Path             string                   // Fully qualified path to the file
    PathInModule     string                   // Path within the module to the file
    AnonymousImports []*ParsedImport          // Import declarations that were imported with .
    NamedImports     map[string]*ParsedImport // Import declarations - map from shortname to fully qualified package import name
    Ast              *ast.File                // The AST of the file
}
```

<a name="ParsedFile.LoadFuncs"></a>
### func \(\*ParsedFile\) [LoadFuncs](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L627>)

```go
func (f *ParsedFile) LoadFuncs() error
```

Assumes that all structs and interfaces have been loaded for the package containing the file.

Loads the names of all funcs. If the func has a receiver type, then it is saved as a method on the appropriate struct; if it does not have a receiver type, then it is saved as a package func.

This does not parse the arguments or returns of the func

<a name="ParsedFile.LoadImports"></a>
### func \(\*ParsedFile\) [LoadImports](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L458>)

```go
func (f *ParsedFile) LoadImports() error
```



<a name="ParsedFile.LoadStructsAndInterfaces"></a>
### func \(\*ParsedFile\) [LoadStructsAndInterfaces](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L495>)

```go
func (f *ParsedFile) LoadStructsAndInterfaces() error
```

Looks for:

- structs defined in the file
- interfaces defined in the file
- other user types defined in the file

Does not:

- look for function declarations

<a name="ParsedFile.LoadVars"></a>
### func \(\*ParsedFile\) [LoadVars](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L594>)

```go
func (f *ParsedFile) LoadVars() error
```

Looks for:

- vars declared

<a name="ParsedFile.ResolveIdent"></a>
### func \(\*ParsedFile\) [ResolveIdent](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L372>)

```go
func (f *ParsedFile) ResolveIdent(name string, typeParams ...string) gocode.TypeName
```

An ident can be:

- a basic type, like int64, float32 etc.
- any
- a type declared locally within the file or package
- a type imported with an \`import . "package"\` decl
- a generic type from a struct or func's type params

<a name="ParsedFile.ResolveSelector"></a>
### func \(\*ParsedFile\) [ResolveSelector](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L400>)

```go
func (f *ParsedFile) ResolveSelector(packageShortName string, name string) gocode.TypeName
```



<a name="ParsedFile.ResolveType"></a>
### func \(\*ParsedFile\) [ResolveType](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L412>)

```go
func (f *ParsedFile) ResolveType(expr ast.Expr, typeParams ...string) gocode.TypeName
```

If the expr is in the context of a generic struct or func, typeParams provides the additional named type params

<a name="ParsedFile.String"></a>
### func \(\*ParsedFile\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L772>)

```go
func (f *ParsedFile) String() string
```



<a name="ParsedFunc"></a>
## type [ParsedFunc](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L92-L96>)



```go
type ParsedFunc struct {
    gocode.Func
    File *ParsedFile
    Ast  *ast.FuncType
}
```

<a name="ParsedFunc.AsConstructor"></a>
### func \(\*ParsedFunc\) [AsConstructor](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L721>)

```go
func (f *ParsedFunc) AsConstructor() *gocode.Constructor
```



<a name="ParsedFunc.Parse"></a>
### func \(\*ParsedFunc\) [Parse](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L322>)

```go
func (f *ParsedFunc) Parse() error
```



<a name="ParsedFunc.String"></a>
### func \(\*ParsedFunc\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L807>)

```go
func (f *ParsedFunc) String() string
```



<a name="ParsedImport"></a>
## type [ParsedImport](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L105-L108>)



```go
type ParsedImport struct {
    File    *ParsedFile
    Package string
}
```

<a name="ParsedInterface"></a>
## type [ParsedInterface](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L85-L90>)



```go
type ParsedInterface struct {
    File    *ParsedFile
    Ast     *ast.InterfaceType
    Name    string
    Methods map[string]*ParsedFunc
}
```

<a name="ParsedInterface.ServiceInterface"></a>
### func \(\*ParsedInterface\) [ServiceInterface](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L705>)

```go
func (iface *ParsedInterface) ServiceInterface(ctx ir.BuildContext) *gocode.ServiceInterface
```



<a name="ParsedInterface.String"></a>
### func \(\*ParsedInterface\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L797>)

```go
func (i *ParsedInterface) String() string
```



<a name="ParsedInterface.Type"></a>
### func \(\*ParsedInterface\) [Type](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L691>)

```go
func (iface *ParsedInterface) Type() *gocode.UserType
```



<a name="ParsedModule"></a>
## type [ParsedModule](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L38-L46>)



```go
type ParsedModule struct {
    ShortName string                    // Short name of the module
    Name      string                    // Fully qualified name of the module
    Version   string                    // Version of the module
    SrcDir    string                    // Fully qualified location of the module on the filesystem
    IsLocal   bool                      // Is this a local module or from the go cache?
    Modfile   *modfile.File             // The modfile File struct is sufficiently simple that we just use it directly
    Packages  map[string]*ParsedPackage // Map from fully qualified package name to ParsedPackage
}
```

<a name="ParsedModule.Load"></a>
### func \(\*ParsedModule\) [Load](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L167>)

```go
func (mod *ParsedModule) Load() error
```



<a name="ParsedModule.String"></a>
### func \(\*ParsedModule\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L736>)

```go
func (mod *ParsedModule) String() string
```



<a name="ParsedModuleSet"></a>
## type [ParsedModuleSet](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/moduleset.go#L12-L16>)

Represents a set of code modules that have been parsed.

```go
type ParsedModuleSet struct {
    Modules    map[string]*ParsedModule // Map from FQ module name to module object
    ModuleDirs map[string]*ParsedModule // Map from module SrcDir to module object
    Parent     *ParsedModuleSet         // Another module set to consult for modules if not present in this one
}
```

<a name="New"></a>
### func [New](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/moduleset.go#L19>)

```go
func New(parent *ParsedModuleSet) *ParsedModuleSet
```

Returns a new [\\\*ParsedModuleSet](<#ParsedModuleSet>), optionally with a parent module set, which can be nil.

<a name="ParsedModuleSet.Add"></a>
### func \(\*ParsedModuleSet\) [Add](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/moduleset.go#L31>)

```go
func (set *ParsedModuleSet) Add(info *ModuleInfo) (*ParsedModule, error)
```

Adds a module to the parsed module set. This is the preferred method for adding modules, versus \[AddModule\].

info for a module can be acquired by calling [FindPackageModule](<#FindPackageModule>) or [FindModule](<#FindModule>)

<a name="ParsedModuleSet.AddModule"></a>
### func \(\*ParsedModuleSet\) [AddModule](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/moduleset.go#L51>)

```go
func (set *ParsedModuleSet) AddModule(srcDir string) (*ParsedModule, error)
```

Manually parse and add a module to the parsed module set

If the srcDir has already been parsed, then this function will do nothing.

If \[set.Parent\] is not nil, then the module will be copied from \[set.Parent\] rather than re\-parsed.

If \[set\] already contains a module with the same FQ module name as the one in srcDir then this function will return an error.

The parsed module will be assumed to be a local module; if it is not, then set \[IsLocal\] to false

<a name="ParsedModuleSet.AddModules"></a>
### func \(\*ParsedModuleSet\) [AddModules](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/moduleset.go#L64>)

```go
func (set *ParsedModuleSet) AddModules(srcDirs ...string) error
```

Manually parse and add multiple modules to the set.

Equivalent to calling \[AddModule\] for each srcDir. If a srcDir has already been parsed then it will not be re\-parsed.

Returns an error if any of the modules cannot be parsed.

<a name="ParsedModuleSet.AddWorkspace"></a>
### func \(\*ParsedModuleSet\) [AddWorkspace](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/moduleset.go#L109>)

```go
func (set *ParsedModuleSet) AddWorkspace(workspaceDir string) error
```

Parses and adds all modules in the specified workspaceDir

<a name="ParsedModuleSet.FindInterface"></a>
### func \(\*ParsedModuleSet\) [FindInterface](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/moduleset.go#L188>)

```go
func (set *ParsedModuleSet) FindInterface(pkgName string, name string) (*ParsedInterface, error)
```

Looks up the specified interface, possibly searching for and parsing the package.

Returns an error if the package cannot be found or parsed.

Returns the [\\\*ParsedInterface](<#ParsedInterface>) if found, or nil if no such interface exists in the package.

<a name="ParsedModuleSet.FindStruct"></a>
### func \(\*ParsedModuleSet\) [FindStruct](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/moduleset.go#L171>)

```go
func (set *ParsedModuleSet) FindStruct(pkgName string, name string) (*ParsedStruct, error)
```

Looks up the specified struct, possibly searching for and parsing the package.

Returns an error if the package cannot be found or parsed.

Returns the [\\\*ParsedStruct](<#ParsedStruct>) if found, or nil if no such struct exists in the package.

<a name="ParsedModuleSet.GetPackage"></a>
### func \(\*ParsedModuleSet\) [GetPackage](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/moduleset.go#L129>)

```go
func (set *ParsedModuleSet) GetPackage(name string) (*ParsedPackage, error)
```

Gets the [\\\*ParsedPackage](<#ParsedPackage>) for the specified name, possibly searching for and parsing the package.

This method will return an error if the package was not found, or if there was a parse error

<a name="ParsedModuleSet.String"></a>
### func \(\*ParsedModuleSet\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L728>)

```go
func (set *ParsedModuleSet) String() string
```



<a name="ParsedPackage"></a>
## type [ParsedPackage](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L48-L61>)



```go
type ParsedPackage struct {
    Module        *ParsedModule
    Name          string                      // Fully qualified name of the package including module name
    ShortName     string                      // Shortname of the package (ie, the name used in an import statement)
    PackageDir    string                      // Subdirectory within the module containing the package
    SrcDir        string                      // Fully qualified location of the package on the filesystem
    Files         map[string]*ParsedFile      // Map from filename to ParsedFile
    Ast           *ast.Package                // The AST of the package
    DeclaredTypes map[string]gocode.UserType  // Types declared within this package
    Structs       map[string]*ParsedStruct    // Structs parsed from this package
    Interfaces    map[string]*ParsedInterface // Interfaces parsed from this package
    Funcs         map[string]*ParsedFunc      // Functions parsed from this package (does not include funcs with receiver types)
    Vars          map[string]*ParsedVar       // Vars declared in this package; we save their AST but don't process them
}
```

<a name="ParsedPackage.Load"></a>
### func \(\*ParsedPackage\) [Load](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L226>)

```go
func (pkg *ParsedPackage) Load() error
```



<a name="ParsedPackage.Parse"></a>
### func \(\*ParsedPackage\) [Parse](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L280>)

```go
func (pkg *ParsedPackage) Parse() error
```



<a name="ParsedPackage.String"></a>
### func \(\*ParsedPackage\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L748>)

```go
func (pkg *ParsedPackage) String() string
```



<a name="ParsedStruct"></a>
## type [ParsedStruct](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L73-L83>)



```go
type ParsedStruct struct {
    File            *ParsedFile
    Ast             *ast.StructType
    Name            string
    Methods         map[string]*ParsedFunc  // Methods declared directly on this struct, does not include promoted methods (not implemented yet)
    FieldsList      []*ParsedField          // All fields in the order that they are declared
    Fields          map[string]*ParsedField // Named fields declared in this struct only, does not include promoted fields (not implemented yet)
    PromotedField   *ParsedField            // If there is a promoted field, stored here
    AnonymousFields []*ParsedField          // Subsequent anonymous fields
    TypeParams      []string                // Names of generic type parameters
}
```

<a name="ParsedStruct.String"></a>
### func \(\*ParsedStruct\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L787>)

```go
func (f *ParsedStruct) String() string
```



<a name="ParsedStruct.Type"></a>
### func \(\*ParsedStruct\) [Type](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L698>)

```go
func (struc *ParsedStruct) Type() *gocode.UserType
```



<a name="ParsedVar"></a>
## type [ParsedVar](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/golang/goparser/parser.go#L99-L103>)

Currently we save var statements but don't do anything with them

```go
type ParsedVar struct {
    File *ParsedFile
    Name string
    Ast  *ast.ValueSpec
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
