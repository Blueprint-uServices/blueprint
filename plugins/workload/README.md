<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# workload

```go
import "github.com/blueprint-uservices/blueprint/plugins/workload"
```

Package workload is a plugin for creating executable workload generators. A workload is a client to the application that submits requests to the application, thereby generating load.

Most out\-of\-the\-box Blueprint applications will come with a workload generator that can be included with the compiled application using this plugin. Typically the workload generator is implemented in a directory called "workload" next to the application's workflow, wiring, and tests.

When writing your own Blueprint application, it is recommended to also write a workload generator for the application, so that it is easy for users to deploy the application and run a workload against it. The section "Writing Workload Generators" below outlines how to write custom workload generators.

### Wiring Spec Usage

To include a workload generator in your wiring spec, specify a name for the workload generator and provide the workloadgen interface or implementation as type parameter. A typical workload generator will also have some arguments that are service clients.

```
workload.Generator[WorkloadImpl](spec, "my_workload_gen", "my_frontend_service")
```

The workload plugin will search the workflow spec modules for a valid workflow service called "WorkloadImpl". It will create and compile a process that runs the service. See for example the [SockShop Workload Generator](<https://github.com/blueprint-uservices/blueprint/tree/main/examples/sockshop/workload/workloadgen/workload.go>).

### Artifacts Generated

The plugin creates a subdirectory in the output containing the workload generator source. The plugin also compiles the workload generator source into an executable that resides in the subdirectory.

### Running the Workload Generator

The workload generator plugin automatically compiles an executable binary. Navigate to the output directory and run the binary, e.g.

```
chmod +x ./build/my_workload_gen/my_workload_gen_proc
./build/my_workload_gen/my_workload_gen_proc
```

Your application will probably require some addresses to be provided as arguments, and will complain if they are absent.

For convenience, the generated source for the workload generator is also included in the build directory.

### Writing Workload Generators

You can implement your workload generator within the same package/module as your workflow logic or in a separate package/module. For convention, we recommend implementing your workload generator in a separate module called "workload" alongside your workflow, wiring, and tests directories.

Workload generators are implemented in an identical manner to workflow services. They receive service clients as arguments. They can define additional flags for command\-line arguments to configure the workload \(e.g. number of threads, request rate, etc.\).

The logic of the workload generator should reside in the Run method. See [SockShop Workload Generator](<https://github.com/blueprint-uservices/blueprint/tree/main/examples/sockshop/workload/workloadgen/workload.go>) for an example.

### Example:

```
// The WorkloadGen interface, to use as the workloadType in the call to workload.Generator
type SimpleWorkload interface {
	ImplementsSimpleWorkload(context.Context) error
}

// WorkloadGen implementation
type workloadGen struct {
	SimpleWorkload

	frontend frontend.Frontend 		// Application client
}

var myarg = flag.Int("myarg", 12345, "help message for myarg")

func NewSimpleWorkload(ctx context.Context, frontend frontend.Frontend) (SimpleWorkload, error) {
	return &workloadGen{frontend: frontend}, nil
}

func (s *workloadGen) Run(ctx context.Context) error {
	fmt.Printf("myarg is %v\n", *myarg)
	ticker := time.NewTicker(1 * time.Second)
	for {
		// Workload runs here
		select {
		case <-ctx.Done():
			return nil
		case t := <-ticker.C:
			fmt.Println("Tick at", t)
		}
	}
}

func (s *workloadGen) ImplementsSimpleWorkload(context.Context) error {
	return nil
}
```

## Index

- [func Generator\[GeneratorType any\]\(spec wiring.WiringSpec, name string, workloadArgs ...string\) string](<#Generator>)


<a name="Generator"></a>
## func [Generator](<https://github.com/blueprint-uservices/blueprint/blob/main/plugins/workload/wiring.go#L109>)

```go
func Generator[GeneratorType any](spec wiring.WiringSpec, name string, workloadArgs ...string) string
```

[Generator](<#Generator>) can be used by wiring specs to build an executable workload generator.

workloadType should correspond to a workload generator implementation

workloadArgs should correspond to arguments used by the workload generator implementation

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
