<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# wiring

```go
import "gitlab.mpi-sws.org/cld/blueprint/blueprint/pkg/wiring"
```

Package wiring provides the entry point for a Blueprint application to create and configure a wiring spec; that wiring spec can enriched and extended by plugins; ultimately it is used by applications to generate concrete application instances.

The starting point for a Blueprint application is the [NewWiringSpec](<#NewWiringSpec>) function. Subsequently, Blueprint applications should typically not need to directly invoke methods on the [WiringSpec](<#WiringSpec>) instance; instead the applications should invoke plugins, passing the [WiringSpec](<#WiringSpec>) instance to those plugins.

## Index

- [func BuildApplicationIR\(spec WiringSpec, name string, nodesToInstantiate ...string\) \(\*ir.ApplicationNode, error\)](<#BuildApplicationIR>)
- [type BuildFunc](<#BuildFunc>)
- [type DefaultNamespaceHandler](<#DefaultNamespaceHandler>)
  - [func \(handler \*DefaultNamespaceHandler\) Accepts\(nodeType any\) bool](<#DefaultNamespaceHandler.Accepts>)
  - [func \(handler \*DefaultNamespaceHandler\) AddEdge\(name string, node ir.IRNode\) error](<#DefaultNamespaceHandler.AddEdge>)
  - [func \(handler \*DefaultNamespaceHandler\) AddNode\(name string, node ir.IRNode\) error](<#DefaultNamespaceHandler.AddNode>)
  - [func \(handler \*DefaultNamespaceHandler\) Init\(namespace \*SimpleNamespace\)](<#DefaultNamespaceHandler.Init>)
  - [func \(handler \*DefaultNamespaceHandler\) LookupDef\(name string\) \(\*WiringDef, error\)](<#DefaultNamespaceHandler.LookupDef>)
- [type Namespace](<#Namespace>)
- [type SimpleNamespace](<#SimpleNamespace>)
  - [func \(namespace \*SimpleNamespace\) Debug\(message string, args ...any\)](<#SimpleNamespace.Debug>)
  - [func \(namespace \*SimpleNamespace\) Defer\(f func\(\) error\)](<#SimpleNamespace.Defer>)
  - [func \(namespace \*SimpleNamespace\) Error\(message string, args ...any\) error](<#SimpleNamespace.Error>)
  - [func \(namespace \*SimpleNamespace\) Get\(name string, dst any\) error](<#SimpleNamespace.Get>)
  - [func \(namespace \*SimpleNamespace\) GetProperties\(name string, key string, dst any\) error](<#SimpleNamespace.GetProperties>)
  - [func \(namespace \*SimpleNamespace\) GetProperty\(name string, key string, dst any\) error](<#SimpleNamespace.GetProperty>)
  - [func \(namespace \*SimpleNamespace\) Info\(message string, args ...any\)](<#SimpleNamespace.Info>)
  - [func \(namespace \*SimpleNamespace\) Init\(name, namespacetype string, parent Namespace, wiring WiringSpec, handler SimpleNamespaceHandler\)](<#SimpleNamespace.Init>)
  - [func \(namespace \*SimpleNamespace\) Instantiate\(name string, dst any\) error](<#SimpleNamespace.Instantiate>)
  - [func \(namespace \*SimpleNamespace\) Name\(\) string](<#SimpleNamespace.Name>)
  - [func \(namespace \*SimpleNamespace\) Put\(name string, node ir.IRNode\) error](<#SimpleNamespace.Put>)
- [type SimpleNamespaceHandler](<#SimpleNamespaceHandler>)
- [type WiringDef](<#WiringDef>)
  - [func \(def \*WiringDef\) AddProperty\(key string, value any\)](<#WiringDef.AddProperty>)
  - [func \(def \*WiringDef\) GetProperties\(key string, dst any\) error](<#WiringDef.GetProperties>)
  - [func \(def \*WiringDef\) GetProperty\(key string, dst any\) error](<#WiringDef.GetProperty>)
  - [func \(def \*WiringDef\) String\(\) string](<#WiringDef.String>)
- [type WiringError](<#WiringError>)
  - [func \(e WiringError\) Error\(\) string](<#WiringError.Error>)
- [type WiringSpec](<#WiringSpec>)
  - [func NewWiringSpec\(name string\) WiringSpec](<#NewWiringSpec>)


<a name="BuildApplicationIR"></a>
## func BuildApplicationIR

```go
func BuildApplicationIR(spec WiringSpec, name string, nodesToInstantiate ...string) (*ir.ApplicationNode, error)
```

Builds the IR of an application using the definitions of the provided spec. Returns an \[ir.ApplicationNode\] of the application.

Callers should typically provide nodesToInstantiate to specify which nodes should be instantiated in the application. This method will recursively instantiate any dependencies.

If nodesToInstantiate is empty, all nodes will be instantiated, but this might not result in an application with the desired topology. Hence the recommended approach is to explicitly specify which nodes to instantiate.

<a name="BuildFunc"></a>
## type BuildFunc

Creates an IR node within the provided namespace or within a new child namespace. Other named IR nodes can be fetched from the provided Namespace by invoking \[Namespace.Get\] or other [Namespace](<#Namespace>) methods.

```go
type BuildFunc func(Namespace) (ir.IRNode, error)
```

<a name="DefaultNamespaceHandler"></a>
## type DefaultNamespaceHandler

A basic [SimpleNamespaceHandler](<#SimpleNamespaceHandler>) implementation that accepts nodes of all types.

```go
type DefaultNamespaceHandler struct {
    SimpleNamespaceHandler
    Namespace *SimpleNamespace

    Nodes []ir.IRNode
    Edges []ir.IRNode
}
```

<a name="DefaultNamespaceHandler.Accepts"></a>
### func \(\*DefaultNamespaceHandler\) Accepts

```go
func (handler *DefaultNamespaceHandler) Accepts(nodeType any) bool
```



<a name="DefaultNamespaceHandler.AddEdge"></a>
### func \(\*DefaultNamespaceHandler\) AddEdge

```go
func (handler *DefaultNamespaceHandler) AddEdge(name string, node ir.IRNode) error
```



<a name="DefaultNamespaceHandler.AddNode"></a>
### func \(\*DefaultNamespaceHandler\) AddNode

```go
func (handler *DefaultNamespaceHandler) AddNode(name string, node ir.IRNode) error
```



<a name="DefaultNamespaceHandler.Init"></a>
### func \(\*DefaultNamespaceHandler\) Init

```go
func (handler *DefaultNamespaceHandler) Init(namespace *SimpleNamespace)
```



<a name="DefaultNamespaceHandler.LookupDef"></a>
### func \(\*DefaultNamespaceHandler\) LookupDef

```go
func (handler *DefaultNamespaceHandler) LookupDef(name string) (*WiringDef, error)
```



<a name="Namespace"></a>
## type Namespace

Namespace is a dependency injection container used by Blueprint plugins during Blueprint's IR construction process. Namespaces instantiate and store IRNodes. A root Blueprint application is itself a Namespace.

A Namespace argument is passed to the [BuildFunc](<#BuildFunc>) when an IRNode is being built. An IRNode can potentially be built multiple times, in different namespaces.

If an IRNode depends on other IRNodes, those others can be fetched by calling \[Namespace.Get\]. If those IRNodes haven't yet been built, then their BuildFuncs will also be invoked, recursively. Conversely, if those IRNodes are already built, then the built instance is re\-used.

Namespaces are hierarchical and a namespace implementation can choose to only support a subset of IRNodes. In this case, \[Namespace.Get\] on an unsupported IRNode will recursively get the node on the parent namespace. Namespaces inspect the nodeType argument of \[WiringSpec.Define\] to make this decision.

```go
type Namespace interface {
    // Returns the name of this namespace
    Name() string

    // Gets an IRNode with the specified name from this namespace, placing the result in the pointer dst.
    // dst should typically be a pointer to an IRNode type.
    // If the node has already been built, it returns the existing built node.
    // If the node hasn't yet been built, the node's [BuildFunc] will be called and the result will be
    // cached and returned.
    // This call might recursively call [Get] on a parent namespace depending on the [nodeType] registered
    // for name.
    Get(name string, dst any) error

    // The same as [Get] but without creating a depending (an edge) into the current namespace.  Most
    // plugins should use [Get] instead.
    Instantiate(name string, dst any) error

    // Gets a property from the wiring spec; dst should be a pointer to a value
    GetProperty(name string, key string, dst any) error

    // Gets a slice of properties from the wiring spec; dst should be a pointer to a slice
    GetProperties(name string, key string, dst any) error

    // Puts a node into this namespace
    Put(name string, node ir.IRNode) error

    // Enqueue a function to be executed after all currently-queued functions have finished executing.
    // Most plugins should not need to use this.
    Defer(f func() error)

    // Log an info-level message
    Info(message string, args ...any)

    // Log a warn-level message
    Warn(message string, args ...any)

    // Log an error-level message
    Error(message string, args ...any) error
}
```

<a name="SimpleNamespace"></a>
## type SimpleNamespace

SimpleNamespace is a base implementation of a [Namespace](<#Namespace>) that provides implementations of most methods.

Most plugins that want to implement a [Namespace](<#Namespace>) will want to use [SimpleNamespace](<#SimpleNamespace>) and only provide a [SimpleNamespaceHandler](<#SimpleNamespaceHandler>) implementation for a few of the custom namespace logics.

See the documentation of [SimpleNamespaceHandler](<#SimpleNamespaceHandler>) for methods to implement.

```go
type SimpleNamespace struct {
    Namespace

    NamespaceName   string                 // A name for this namespace
    NamespaceType   string                 // The type of this namespace
    ParentNamespace Namespace              // The parent namespace that created this namespace; can be nil
    Wiring          WiringSpec             // The wiring spec
    Handler         SimpleNamespaceHandler // User-provided handler
    Seen            map[string]ir.IRNode   // Cache of built nodes
    Added           map[string]any         // Nodes that have been passed to the handler
    Deferred        []func() error         // Deferred functions to execute
    // contains filtered or unexported fields
}
```

<a name="SimpleNamespace.Debug"></a>
### func \(\*SimpleNamespace\) Debug

```go
func (namespace *SimpleNamespace) Debug(message string, args ...any)
```



<a name="SimpleNamespace.Defer"></a>
### func \(\*SimpleNamespace\) Defer

```go
func (namespace *SimpleNamespace) Defer(f func() error)
```



<a name="SimpleNamespace.Error"></a>
### func \(\*SimpleNamespace\) Error

```go
func (namespace *SimpleNamespace) Error(message string, args ...any) error
```



<a name="SimpleNamespace.Get"></a>
### func \(\*SimpleNamespace\) Get

```go
func (namespace *SimpleNamespace) Get(name string, dst any) error
```



<a name="SimpleNamespace.GetProperties"></a>
### func \(\*SimpleNamespace\) GetProperties

```go
func (namespace *SimpleNamespace) GetProperties(name string, key string, dst any) error
```



<a name="SimpleNamespace.GetProperty"></a>
### func \(\*SimpleNamespace\) GetProperty

```go
func (namespace *SimpleNamespace) GetProperty(name string, key string, dst any) error
```



<a name="SimpleNamespace.Info"></a>
### func \(\*SimpleNamespace\) Info

```go
func (namespace *SimpleNamespace) Info(message string, args ...any)
```



<a name="SimpleNamespace.Init"></a>
### func \(\*SimpleNamespace\) Init

```go
func (namespace *SimpleNamespace) Init(name, namespacetype string, parent Namespace, wiring WiringSpec, handler SimpleNamespaceHandler)
```

Initializes a SimpleNamespace. To do so, a parent namespace, wiring spec, and [SimpleNamespaceHandler](<#SimpleNamespaceHandler>) implementation must be provided.

<a name="SimpleNamespace.Instantiate"></a>
### func \(\*SimpleNamespace\) Instantiate

```go
func (namespace *SimpleNamespace) Instantiate(name string, dst any) error
```



<a name="SimpleNamespace.Name"></a>
### func \(\*SimpleNamespace\) Name

```go
func (namespace *SimpleNamespace) Name() string
```



<a name="SimpleNamespace.Put"></a>
### func \(\*SimpleNamespace\) Put

```go
func (namespace *SimpleNamespace) Put(name string, node ir.IRNode) error
```



<a name="SimpleNamespaceHandler"></a>
## type SimpleNamespaceHandler

SimpleNamespaceHandler is an interface intended for use by any Blueprint plugin that wants to provide a custom namespace.

The plugin should implement the methods of this handler and then create a [SimpleNamespace](<#SimpleNamespace>) and call [SimpleNamespace.Init](<#SimpleNamespace.Init>)

```go
type SimpleNamespaceHandler interface {
    // Initialize the handler with a namespace
    Init(*SimpleNamespace)

    // Look up a [WiringDef] from the wiring spec.
    LookupDef(string) (*WiringDef, error)

    // Reports true if this namespace can build nodes of the specified node type.
    //
    // For some node type T, if Accepts(T) returns false, then nodes of type T will
    // not be built in this namespace and instead the parent namespace will be called.
    Accepts(any) bool

    // After a node has been gotten from the parent namespace, AddEdge will be
    // called to inform the handler that the node should be passed to this namespace
    // as an argument.
    AddEdge(string, ir.IRNode) error

    // After a node has been built in this namespace, AddNode will be called
    // to enable the handler to save the built node.
    AddNode(string, ir.IRNode) error
}
```

<a name="WiringDef"></a>
## type WiringDef



```go
type WiringDef struct {
    Name       string
    NodeType   any
    Build      BuildFunc
    Properties map[string][]any
}
```

<a name="WiringDef.AddProperty"></a>
### func \(\*WiringDef\) AddProperty

```go
func (def *WiringDef) AddProperty(key string, value any)
```



<a name="WiringDef.GetProperties"></a>
### func \(\*WiringDef\) GetProperties

```go
func (def *WiringDef) GetProperties(key string, dst any) error
```



<a name="WiringDef.GetProperty"></a>
### func \(\*WiringDef\) GetProperty

```go
func (def *WiringDef) GetProperty(key string, dst any) error
```



<a name="WiringDef.String"></a>
### func \(\*WiringDef\) String

```go
func (def *WiringDef) String() string
```



<a name="WiringError"></a>
## type WiringError



```go
type WiringError struct {
    Errors []error
}
```

<a name="WiringError.Error"></a>
### func \(WiringError\) Error

```go
func (e WiringError) Error() string
```



<a name="WiringSpec"></a>
## type WiringSpec



```go
type WiringSpec interface {
    Define(name string, nodeType any, build BuildFunc) // Adds a named node definition to the spec that can be built with the provided build function
    GetDef(name string) *WiringDef                     // For use by plugins to access the defined build functions and metadata
    Defs() []string                                    // Returns names of all defined nodes

    Alias(name string, pointsto string)   // Defines an alias to another defined node; these can be recursive
    GetAlias(alias string) (string, bool) // Gets the value of the specified alias, if it exists

    SetProperty(name string, key string, value any)       // Sets a static property value in the wiring spec, replacing any existing value specified
    AddProperty(name string, key string, value any)       // Adds a static property value in the wiring spec
    GetProperty(name string, key string, dst any) error   // Gets a static property value from the wiring spec
    GetProperties(name string, key string, dst any) error // Gets all static property values from the wiring spec

    String() string // Returns a string representation of everything that has been defined

    // Errors while building a wiring spec are accumulated within the wiring spec, rather than as return values to calls
    AddError(err error) // Used by plugins to signify an error; the error will be returned by a call to Err or GetBlueprint
    Err() error         // Gets an error if there is currently one

    BuildIR(nodesToInstantiate ...string) (*ir.ApplicationNode, error) // After defining everything, this builds the IR for the specified named nodes (implicitly including dependencies of those nodes)
}
```

<a name="NewWiringSpec"></a>
### func NewWiringSpec

```go
func NewWiringSpec(name string) WiringSpec
```



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
