<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# address

```go
import "github.com/blueprint-uservices/blueprint/blueprint/pkg/coreplugins/address"
```

Package address provides IR nodes to represent addressing, particularly between clients and servers.

This plugin is primarily for use by other Blueprint plugins. It is not expected that a wiring spec needs to directly call methods from this package.

The main usage by other Blueprint plugins is the Define method, which will define an address that points to an IR node of a specified type. Within a buildfunc, plugins can directly get the address by name, or use the helper methods Bind and Dial to get only the relevant configuration nodes.

To implement addressing, several concerns are addressed:

- when a client node is instantiated it usually wants to access the server node in order to discover the server's address and its interface. But the client doesn't want to accidentally instantiate the server in the wrong place. An Address node adds one layer of indirection to prevent this.
- an address node takes care of configuration variables for binding and dialling the address.

## Index

- [func AssignPorts\(hostname string, nodes \[\]ir.IRNode\) error](<#AssignPorts>)
- [func Bind\[ServerType ir.IRNode\]\(namespace wiring.Namespace, addressName string, serverNode ServerType, dst \*\*BindConfig\) error](<#Bind>)
- [func CheckPorts\(nodes \[\]ir.IRNode\) error](<#CheckPorts>)
- [func Define\[ServerType ir.IRNode\]\(spec wiring.WiringSpec, addressName string, pointsTo string, opts ...AddressOpts\)](<#Define>)
- [func ResetPorts\(nodes \[\]ir.IRNode\)](<#ResetPorts>)
- [type Address](<#Address>)
  - [func Dial\[ServerType ir.IRNode\]\(namespace wiring.Namespace, addressName string\) \(\*Address\[ServerType\], error\)](<#Dial>)
  - [func \(addr \*Address\[ServerType\]\) GetDestination\(\) ir.IRNode](<#Address[ServerType].GetDestination>)
  - [func \(addr \*Address\[ServerType\]\) ImplementsAddressNode\(\)](<#Address[ServerType].ImplementsAddressNode>)
  - [func \(addr \*Address\[ServerType\]\) ImplementsIRMetadata\(\)](<#Address[ServerType].ImplementsIRMetadata>)
  - [func \(addr \*Address\[ServerType\]\) Name\(\) string](<#Address[ServerType].Name>)
  - [func \(addr \*Address\[ServerType\]\) SetDestination\(node ir.IRNode\) error](<#Address[ServerType].SetDestination>)
  - [func \(addr \*Address\[ServerType\]\) String\(\) string](<#Address[ServerType].String>)
- [type AddressDef](<#AddressDef>)
  - [func GetAddress\(spec wiring.WiringSpec, name string\) \*AddressDef](<#GetAddress>)
- [type AddressOpts](<#AddressOpts>)
- [type BindConfig](<#BindConfig>)
  - [func \(conf \*BindConfig\) ImplementsBindConfig\(\)](<#BindConfig.ImplementsBindConfig>)
- [type DialConfig](<#DialConfig>)
  - [func \(conf \*DialConfig\) ImplementsDialConfig\(\)](<#DialConfig.ImplementsDialConfig>)
- [type Node](<#Node>)


<a name="AssignPorts"></a>
## func [AssignPorts](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/portassignment.go#L28>)

```go
func AssignPorts(hostname string, nodes []ir.IRNode) error
```

AssignPorts is a helper method intended for use by namespace nodes when they are compiling code and concrete ports must be assigned to [BindConfig](<#BindConfig>) IR nodes.

The provided nodes can be any IR nodes; this method will filter out only the [BindConfig](<#BindConfig>) nodes.

Some of the provided nodes might already be assigned to a particular port. This method will not change those port assignments, though it will return an error if two nodes are already pre\-assigned to the same port.

Ports will be assigned either ascending from port 2000, or ascending from a node's preferred port if a preference was specified.

After calling this method, any provided [BindConfig](<#BindConfig>) IR nodes will have their hostname and port set.

<a name="Bind"></a>
## func [Bind](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/wiring.go#L93>)

```go
func Bind[ServerType ir.IRNode](namespace wiring.Namespace, addressName string, serverNode ServerType, dst **BindConfig) error
```

Gets the [BindConfig](<#BindConfig>) configuration node of addressName from the namespace and places it in dst

This method is intended for use by other Blueprint plugins within their own BuildFuncs.

This is a convenience method for use when only the bind address is needed. It is equivalent to getting addressName directly from namespace and then reading then \[Address.Bind\] field.

In addition to setting the [BindConfig](<#BindConfig>) node in dst, this call sets the destination of the address to be serverNode

<a name="CheckPorts"></a>
## func [CheckPorts](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/portassignment.go#L83>)

```go
func CheckPorts(nodes []ir.IRNode) error
```

Returns an error if there are [BindConfig](<#BindConfig>) nodes in the provided list that haven't been allocated a port.

<a name="Define"></a>
## func [Define](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/wiring.go#L30>)

```go
func Define[ServerType ir.IRNode](spec wiring.WiringSpec, addressName string, pointsTo string, opts ...AddressOpts)
```

Defines an address called addressName whose server\-side node has name pointsTo.

This method is primarily intended for use by other Blueprint plugins.

The type parameter ServerType should correspond to the node type of pointsTo.

By default the address is reachable application wide. [AddressOpts](<#AddressOpts>) can be optionally provided to further configure the address.

<a name="ResetPorts"></a>
## func [ResetPorts](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/portassignment.go#L100>)

```go
func ResetPorts(nodes []ir.IRNode)
```

Clears the hostname and port from any [BindConfig](<#BindConfig>) node.

This is used by namespace nodes when performing address translation, e.g. between ports within a container vs. external to a container.

<a name="Address"></a>
## type [Address](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L77-L82>)

The main implementation of the [Node](<#Node>) interface.

In addition to storing the destination IR node, the address also comes with two configuration IR nodes: a [BindConfig](<#BindConfig>) that is the bind address of the destination node, and a [DialConfig](<#DialConfig>) that is the address callers should dial.

```go
type Address[ServerType ir.IRNode] struct {
    AddrName string
    Server   ServerType
    Bind     *BindConfig // Configuration value for the bind address
    Dial     *DialConfig // Configuration value for the dial address
}
```

<a name="Dial"></a>
### func [Dial](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/wiring.go#L69>)

```go
func Dial[ServerType ir.IRNode](namespace wiring.Namespace, addressName string) (*Address[ServerType], error)
```

Gets the [DialConfig](<#DialConfig>) configuration node of addressName from the namespace.

This method is intended for use by other Blueprint plugins within their own BuildFuncs.

This is a convenience method for use when only the dial address is needed. It is equivalent to getting addressName directly from namespace and then reading then \[Address.Dial\] field.

<a name="Address[ServerType].GetDestination"></a>
### func \(\*Address\[ServerType\]\) [GetDestination](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L93>)

```go
func (addr *Address[ServerType]) GetDestination() ir.IRNode
```



<a name="Address[ServerType].ImplementsAddressNode"></a>
### func \(\*Address\[ServerType\]\) [ImplementsAddressNode](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L109>)

```go
func (addr *Address[ServerType]) ImplementsAddressNode()
```



<a name="Address[ServerType].ImplementsIRMetadata"></a>
### func \(\*Address\[ServerType\]\) [ImplementsIRMetadata](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L110>)

```go
func (addr *Address[ServerType]) ImplementsIRMetadata()
```



<a name="Address[ServerType].Name"></a>
### func \(\*Address\[ServerType\]\) [Name](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L85>)

```go
func (addr *Address[ServerType]) Name() string
```



<a name="Address[ServerType].SetDestination"></a>
### func \(\*Address\[ServerType\]\) [SetDestination](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L100>)

```go
func (addr *Address[ServerType]) SetDestination(node ir.IRNode) error
```



<a name="Address[ServerType].String"></a>
### func \(\*Address\[ServerType\]\) [String](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L89>)

```go
func (addr *Address[ServerType]) String() string
```



<a name="AddressDef"></a>
## type [AddressDef](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/wiring.go#L117-L121>)



```go
type AddressDef struct {
    Name       string
    PointsTo   string
    ServerType any
}
```

<a name="GetAddress"></a>
### func [GetAddress](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/wiring.go#L134>)

```go
func GetAddress(spec wiring.WiringSpec, name string) *AddressDef
```

Gets the AddressDef metadata for an address that was defined using [Define](<#Define>)

<a name="AddressOpts"></a>
## type [AddressOpts](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/wiring.go#L10-L16>)

Additional optional options for use when defining an address

```go
type AddressOpts struct {
    // Defines the nodes that can reach this address.  If left unspecified, an address
    // will be reachable application-wide (ie, Reachability uses the value &ir.ApplicationNode{}).
    // Plugins can restrict an address's reachability by specifying a more restrictive node type,
    // e.g. to restrict an address to only being reachable by nodes within the same container or machine.
    Reachability any
}
```

<a name="BindConfig"></a>
## type [BindConfig](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L59-L62>)

IR config node representing an address that a server should bind to.

```go
type BindConfig struct {
    PreferredPort uint16
    // contains filtered or unexported fields
}
```

<a name="BindConfig.ImplementsBindConfig"></a>
### func \(\*BindConfig\) [ImplementsBindConfig](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L133>)

```go
func (conf *BindConfig) ImplementsBindConfig()
```



<a name="DialConfig"></a>
## type [DialConfig](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L65-L67>)

IR config node representing an address that a client should dial.

```go
type DialConfig struct {
    // contains filtered or unexported fields
}
```

<a name="DialConfig.ImplementsDialConfig"></a>
### func \(\*DialConfig\) [ImplementsDialConfig](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L134>)

```go
func (conf *DialConfig) ImplementsDialConfig()
```



<a name="Node"></a>
## type [Node](<https://github.com/blueprint-uservices/blueprint/blob/main/blueprint/pkg/coreplugins/address/ir.go#L37-L48>)

IR metadata node representing an address.

The main purpose of this node is to enable client nodes to link to server nodes lazily without inadvertently instantiating the server nodes in the wrong namespace.

During the build process, the destination node of an address will be stored on this node. That enables clients, later, to call methods on the server node, e.g. to get the interface that the server node exposes.

The main implementation of this interface is [Address](<#Address>)

```go
type Node interface {
    ir.IRNode
    ir.IRMetadata

    // Returns the server-side of an address if it has been instantiated; nil otherwise
    GetDestination() ir.IRNode

    // Sets the server-side of the address to be the provided node.
    SetDestination(ir.IRNode) error

    ImplementsAddressNode()
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
