<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# workload

```go
import "github.com/blueprint-uservices/blueprint/runtime/core/workload"
```

Package workload provides an abstraction for a workload and a corresponding engine that executes the workload in an open\-loop fashion.

Sample Usage:

import "github.com/Blueprint\-uServices/blueprint/runtime/workload"

```
func (w *SimpleWorkload) Run(ctx context.Context) error {
   wld := workload.NewWorkload()
   wld.AddAPI("read", w.ReadRequestGenerator, 80)
   wld.AddAPI("write", w.WriteRequestGenerator, 20)
   engine, err := workload.NewEngine("stats.csv", 1000, "1m", wld)
   if err != nil { return err }
   engine.RunOpenLoop(ctx)
   return engine.PrintStats()
}
```

For a complete example, refer to https://github.com/Blueprint-uServices/blueprint/tree/main/examples/dsb_hotel/cmplx_workload

## Index

- [type ApiInfo](<#ApiInfo>)
- [type Engine](<#Engine>)
  - [func NewEngine\(outfile string, tput int64, duration string, w \*Workload\) \(\*Engine, error\)](<#NewEngine>)
  - [func \(e \*Engine\) PrintStats\(\) error](<#Engine.PrintStats>)
  - [func \(e \*Engine\) RunOpenLoop\(ctx context.Context\)](<#Engine.RunOpenLoop>)
- [type RequestFunction](<#RequestFunction>)
- [type Stat](<#Stat>)
- [type Workload](<#Workload>)
  - [func NewWorkload\(\) \*Workload](<#NewWorkload>)
  - [func \(w \*Workload\) AddAPI\(name string, fn RequestFunction, proportion int\) error](<#Workload.AddAPI>)
  - [func \(w \*Workload\) IsValid\(\) bool](<#Workload.IsValid>)


<a name="ApiInfo"></a>
## type [ApiInfo](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/workload.go#L29-L33>)

APIInfo encapsulates the execution information for each API.

```go
type ApiInfo struct {
    Name       string
    Fn         RequestFunction
    Proportion int
}
```

<a name="Engine"></a>
## type [Engine](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/engine.go#L19-L25>)

Engine for generating requests by executing a desired workload

```go
type Engine struct {
    Stats      []Stat
    OutFile    string
    TargetTput int64
    Duration   time.Duration
    Wld        *Workload
}
```

<a name="NewEngine"></a>
### func [NewEngine](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/engine.go#L28>)

```go
func NewEngine(outfile string, tput int64, duration string, w *Workload) (*Engine, error)
```

NewEngine creates a new Engine instance for executing the workload

<a name="Engine.PrintStats"></a>
### func \(\*Engine\) [PrintStats](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/engine.go#L117>)

```go
func (e *Engine) PrintStats() error
```

PrintStats prints the collected statistics and writes individual request information to the provided outfile in CSV format.

<a name="Engine.RunOpenLoop"></a>
### func \(\*Engine\) [RunOpenLoop](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/engine.go#L55>)

```go
func (e *Engine) RunOpenLoop(ctx context.Context)
```

RunOpenLoop executes the request in an open loop fashion

<a name="RequestFunction"></a>
## type [RequestFunction](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/workload.go#L26>)

RequestFunction wraps around the request execution and response processing. The function generates the arguments, makes a call to the desired service, and the processes the response. This function is provided by the user for each API.

```go
type RequestFunction func(context.Context) Stat
```

<a name="Stat"></a>
## type [Stat](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/stats.go#L4-L8>)

Stat captures basic statistics about a request

```go
type Stat struct {
    Start    int64
    Duration int64
    IsError  bool
}
```

<a name="Workload"></a>
## type [Workload](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/workload.go#L36-L38>)

Workload represents a workload \(list of APIs and their corresponding proportions\) that is to be executed against the target application.

```go
type Workload struct {
    ApiInfos []ApiInfo
}
```

<a name="NewWorkload"></a>
### func [NewWorkload](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/workload.go#L41>)

```go
func NewWorkload() *Workload
```

NewWorkload creates a new workload instance

<a name="Workload.AddAPI"></a>
### func \(\*Workload\) [AddAPI](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/workload.go#L53>)

```go
func (w *Workload) AddAPI(name string, fn RequestFunction, proportion int) error
```

AddAPI adds a new API to be executed as part of the workload

name is the name of the API fn is the RequestFunction that will generate the required parameters, execute the request, collect and report the stats for the request. proportion is the proportion of requests that need to be executed for this API.

For a workload to be considered valid, the proportions of all the added APIs must sum to 100.

<a name="Workload.IsValid"></a>
### func \(\*Workload\) [IsValid](<https://github.com/Blueprint-uServices/blueprint/blob/main/runtime/core/workload/workload.go#L62>)

```go
func (w *Workload) IsValid() bool
```

IsValid checks if the configured workload is valid or not. Validity Conditions:

- The proportions of all APIs should sum to 100

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
